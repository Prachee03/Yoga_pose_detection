{% load static %}

<!-- index.html -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Home Page</title>
  <style>
    /* Google Font Import Link */
    @import url("https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;700&display=swap");

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      text-decoration: none;
      font-family: "Ubuntu", sans-serif;
    }

    nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 20px;
      transition: all 0.4s ease;
    }

    nav {
      background-color: beige;
    }

    nav.sticky {
      padding: 15px 20px;
      background: burlywood;
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
    }

    nav .nav-content {
      height: 100%;
      max-width: 1200px;
      margin: auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    nav .logo a {
      font-weight: 500;
      font-size: 25px;
      color: burlywood;
    }

    nav.sticky .logo a {
      color: #fff;
    }

    .nav-content .nav-links {
      display: flex;
    }

    .nav-content .nav-links li {
      list-style: none;
      margin: 0 8px;
    }

    .nav-links li a {
      text-decoration: none;
      color: #0e2431;
      font-size: 18px;
      font-weight: 500;
      padding: 10px 4px;
      transition: all 0.3s ease;
    }

    .nav-links li a:hover {
      color: burlywood;
    }

    nav.sticky .nav-links li a {
      color: #fff;
      transition: all 0.4s ease;
    }

    nav.sticky .nav-links li a:hover {
      color: #0e2431;
    }

    .home {
      height: 100vh;
      width: 100%;
      background: url("images/background.png") no-repeat;
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      font-family: "Ubuntu", sans-serif;
    }

    h2 {
      font-size: 30px;
      margin-bottom: 6px;
      color: burlywood;
    }

    .text {
      text-align: justify;
      padding: 40px 80px;
      box-shadow: -5px 0 10px rgba(0, 0, 0, 0.1);
    }

    .buttons {
      margin-top: 20px;
      display: flex;
      justify-content: center;
    }

    .button {
      padding: 10px 20px;
      margin-right: 10px;
      margin-top: 30px;
      background-color: burlywood;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .button:hover {
      background-color: #a96f11;
    }

    .yoga-image-container {
      position: relative;
      width: 100%;
      height: 400px;
      margin-right: 20px;
      overflow: hidden;
      border-radius: 8px;
      margin-top: 20px;
    }

    .yoga-image {
      width: 100%;
      height: auto;
      object-fit: cover;
      filter: brightness(70%);
    }

    .quote {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      text-align: center;
      font-size: 24px;
      font-style: italic;
      width: 80%;
      max-width: 600px;
    }
  </style>
</head>

<body>
  <nav>
    <div class="nav-content">
      <div class="logo">
        <a href="{% url 'index' %}">Yoga Pose Detection System</a>
      </div>
      <ul class="nav-links">
        <li><a href="{% url 'index' %}">Home</a></li>
        <li><a href="{% url 'about' %}">About</a></li>
        <li><a href="{% url 'poses' %}">Poses</a></li>
      </ul>
    </div>
  </nav>

  <div style="margin-top: 85px; margin-left: 60px; margin-right: 60px;">
    <div class="yoga-image-container">
      <img src="{% static 'yoga-pose.jpg' %}" alt="Yoga Image" class="yoga-image" />
      <div class="quote">"The body is your temple. Keep it pure and clean for the soul to reside in."</div>
    </div>

    <div>
  <img src="" alt="" id="img" style='height: 300px; height: 300px; margin-top: 10px; margin-left: 30px;'>
  <img src="" alt="" id="img2" style='height: 300px; height: 300px; margin-top: 10px; margin-left: 300px;'>
</div>
 <div class="buttons">
      <form id="uploadForm" action="{% url 'pose_detection' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" accept="image/*" name="image" onchange="readURL(this)" required oninvalid="this.setCustomValidity('Please select an image file');"
        onvalid="this.setCustomValidity('');" />
        <button type="submit">Upload</button>
      </form>    
        <button id="open-webcam" class="button" onclick="openWebcam()">Open Webcam</button>
        <button id="close-webcam" class="button" style="display: none" onclick="closeWebcam()">Close Webcam</button>
      </div>
    </div>
  </div> 
  <div id="result"></div>
  <video id="video" autoplay style="width: 100%; max-width: 600px; margin-top: 20px;"></video>

  <script>
    let nav = document.querySelector("nav");
    window.onscroll = function () {
      if (document.documentElement.scrollTop > 20) {
        nav.classList.add("sticky");
      } else {
        nav.classList.remove("sticky");
      }
    };

    let stream; // To store the stream object

    function openWebcam() {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(function (mediaStream) {
          stream = mediaStream; // Store the stream object
          let videoElement = document.getElementById("video");
          videoElement.srcObject = mediaStream;
          videoElement.play(); // Start playing the video
          document.getElementById("open-webcam").style.display = "none"; // Hide open button
          document.getElementById("close-webcam").style.display = "inline-block"; // Show close button
        })
        .catch(function (error) {
          console.error("Error opening webcam:", error);
        });
    }

    function closeWebcam() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop()); // Stop all tracks in the stream
        document.getElementById("video").srcObject = null; // Reset video element source
        document.getElementById("open-webcam").style.display = "inline-block"; // Show open button
        document.getElementById("close-webcam").style.display = "none"; // Hide close button
        stream = null; // Reset stream object
      }
    }

    function readURL(input) {
      if (input.files && input.files[0]) {
    
        var reader = new FileReader();
        reader.onload = function (e) { 
          document.querySelector("#img").setAttribute("src",e.target.result);
          document.querySelector("#img2").setAttribute("src","{{processed_image_url}}")
        };

        reader.readAsDataURL(input.files[0]); 
      } 
    }

  </script>
</body>

</html>